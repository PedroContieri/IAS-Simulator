<!DOCTYPE html>
<html>
<head>
	<title>Assembler/Diassembler for IAS</title>
	<script src="ias.js">ias.js has the functionality we need to disassemble IAS instructions</script>
	<script src="assembler.js"></script>
	<script>
		window.onload = function () {
			document.getElementById("btnTest").onclick = function () {
				var txtM = document.getElementById("txtMemMap");
				var txtTO = document.getElementById("txtTestObject");
				var txtOut = document.getElementById("txtOutputReport");

				/* sample test object:
				[
					{
						"input": ["105  00 000 00 3e8"],
						"output": [{"where": "reg", "position": "ac", "value": 31}]
					},
					{
						"input": ["105  00 40506070"],
						"output": [{"where": "reg", "position": "ac", "value": 32848}]
					},
					{
						"input": ["105  00 000 00 010"],
						"output": [{"where": "reg", "position": "ac", "value": 16}]
					},
					{
						"input": ["105  00 00 1fA098"],
						"output": [{"where": "reg", "position": "ac", "value": 1440}]
					},
					{
						"input": ["105  00 000 00 01b"],
						"output": [{"where": "reg", "position": "ac", "value": 5}]
					}
				]
				*/

				try {
					var testObject = JSON.parse(txtTO.value);
					txtOut.value = "";
					for (var i = 0; i < testObject.length; i++) { // for each test
						txtOut.value += "----\n" + "Beginning test " + (i+1) + "\n";
						var map = txtMemMap.value;
						for (var j = 0; j < testObject[i].input.length; j++) { // for each input line
							map += "\n" + testObject[i].input[j];
						}
						IAS.zeroAllRAM();
						IAS.loadRAM(map);
						try { // now run the program until an exception fires (for example, invalid instruction or address: jmp m(0xFFFFF) # halts machine)
							IAS.fetch();
							IAS.execute();
						} catch (ex) {
							txtOut.value += "\n" + IAS.dumpCPU() + "\n\n";
							for (j = 0; j < testObject[i].output.length; j++) { // for each output specification
								var checkoutput = testObject[i].output[j];
								if (checkoutput.where === "reg") {

								} else { // RAM

								}
							}

						}

					}
				} catch (e) {
					alert("an exception was generated in the test:\n" + e.name + "\n" + e.message);
				}
				
			};
		};
	</script>

	<style>
		textarea {
			overflow: auto;
			white-space: nowrap;
		}
		td {
			text-align: center;
		}
	</style>

</head>

<body>

 <table style="width:100%; height:100%;">

  <tr style="height:75%">
    <td>
    	Insert memory map here:
    	<textarea id="txtMemMap" cols="70" rows="30"></textarea>
    	<br>
    	Insert test object here
    	<textarea id="txtTestObject" cols="70" rows="30"></textarea>
    </td>
    <td rowspan="2">
    	<input type="button" id="btnTest" value="Test &gt;&gt;">
    </td>
    <td rowspan="2">
	    Program Execution Report:
	    <textarea id="txtOutputReport" cols="70" rows="70"></textarea>
    </td>
  </tr>

</table> 


</body>
</html>